;(function($){$.fn.multiple_inputs=function(options){var that=this;this.orig_input="";this.config=$.extend({separator:",",min:0,max:0,form_element:"input",list_container:"div",keyboard:true,auto_split:true,show_actions:true,drag_and_drop:true,btn_delete_html:"✘",btn_reorder_html:"↕",btn_reorder_up_html:"↑",btn_reorder_down_html:"↓",btn_add_html:"+",btn_css_class:"btn",btn_delete_css_class:"del",btn_reorder_css_class:"reorder",btn_reorder_up_css_class:"up",btn_reoder_down_css_class:"down",btn_add_css_class:"add"},options);this.init=function(){this.orig_input=this.first();this.orig_input.attr("type","hidden");var val=this.orig_input.val();var vals=val.split(this.config.separator);for(i in vals){this.create_item(vals[i]);}if(this.config.min>0){if(this.config.min<this.num_items()){}}var form=this.orig_input.parents("form");form.on("submit",function(e){that.val();});return this;};this.input_container=function(input){return $(input).parent();};this.prev_input=function(input){return $(input).parent().prev().find("input");};this.next_input=function(input){return $(input).parent().next().find("input");};this.num_items=function(){return that.orig_input.parent().find("input[type=text]").length;};this.delete_item=function(item){this.prev_input(item).focus();this.input_container(item).remove();return this;};this.create_item=function(val,prev_input){if(this.config.max>0&&this.num_items()>=this.config.max){return;}var item=$("<div>").css("clear","both");var input=$("<input />").css("width","80%").css("float","left").attr("type","text").val(val);item.append(input);if(typeof prev_input==="undefined"){this.orig_input.parent().append(item);}else{item.insertAfter(this.input_container(prev_input));}input.focus();input.on("keydown",function(e){if(e.keyCode==13){e.preventDefault();that.create_item("",this);}if(e.keyCode==8||e.keyCode==46){if($(this).val()==""){e.preventDefault();that.delete_item(this);}}if(e.keyCode==38){that.prev_input(this).focus();}if(e.keyCode==40){that.next_input(this).focus();}});input.on("keyup",function(e){if(that.config.auto_split){var sep=that.config.separator;var val=$(this).val();var last_chars=val.substring(val.length-sep.length);if(last_chars==sep){$(this).val(val.substring(0,val.length-sep.length));that.create_item("",this);}}});if(that.config.show_actions){var btn_del=$("<a>").addClass(that.config.btn_css_class).addClass(that.config.btn_delete_css_class).css("margin","5px").html(that.config.btn_delete_html);btn_del.on("click",function(e){that.delete_item(input);});if(that.config.drag_and_drop){var btn_reorder=$("<a>").addClass(that.config.btn_css_class).addClass(that.config.btn_reorder_css_class).css("margin","5px").html(that.config.btn_reorder_html);$(".sortable").sortable({handle:"."+that.config.btn_reorder_css_class,axis:"y",forcePlaceholderSize:true});}else{var btn_reorder_up=$("<a>").addClass(that.config.btn_css_class).addClass(that.config.btn_reorder_up_css_class).css("margin","5px").html(that.config.btn_reorder_up_html);btn_reorder_up.on("click",function(e){var d=that.input_container(that.prev_input(input));input.parent().insertBefore(d);});var btn_reorder_down=$("<a>").addClass(that.config.btn_css_class).addClass(that.config.btn_reorder_down_css_class).css("margin","5px").html(that.config.btn_reorder_down_html);btn_reorder_down.on("click",function(e){var d=that.input_container(that.next_input(input));input.parent().insertAfter(d);});}var btn_add=$("<a>").addClass(that.config.btn_css_class).addClass(that.config.btn_add_css_class).css("margin","5px").html(that.config.btn_add_html);btn_add.on("click",function(e){that.create_item("",input);});var action_container=$("<div>").css("display","none");action_container.append(btn_del);if(that.config.drag_and_drop){action_container.append(btn_reorder);}else{action_container.append(btn_reorder_up);action_container.append(btn_reorder_down);}action_container.append(btn_add);action_container.insertAfter(input);item.on("mouseenter",function(e){action_container.show();});item.on("mouseleave",function(e){action_container.hide();});}};this.val=function(){var vals=[];that.orig_input.parent().find("input[type=text]").each(function(el){vals.push($(this).val());});var v=vals.join(that.config.separator);this.orig_input.val(v);return v;};return this.init();};}(jQuery));