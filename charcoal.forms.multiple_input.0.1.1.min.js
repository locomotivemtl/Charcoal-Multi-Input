/*! Charcoal-Multi-Input 16-07-2014 */
var Charcoal=Charcoal||{};Charcoal.Form=Charcoal.Form||{},Charcoal.Form.Muitple_Inputs=function(a){var b=this;return this.orig_input="",this.config=$.extend({separator:",",min:0,max:0,form_element:"input",list_container:"div",keyboard:!0,auto_split:!0,show_actions:!0,drag_and_drop:!0,btn_delete_html:"✘",btn_reorder_html:"↕",btn_reorder_up_html:"↑",btn_reorder_down_html:"↓",btn_add_html:"+",btn_css_class:"btn",btn_delete_css_class:"del",btn_reorder_css_class:"reorder",btn_reorder_up_css_class:"up",btn_reoder_down_css_class:"down",btn_add_css_class:"add"},a),this.init=function(){this.orig_input=this.first(),this.orig_input.attr("type","hidden");var a=this.orig_input.val(),c=a.split(this.config.separator);for(var d in c)this.create_item(c[d]);this.config.min>0&&this.config.min<this.num_items();var e=this.orig_input.parents("form");return e.on("submit",function(){b.val()}),this},this.input_container=function(a){return $(a).parent()},this.prev_input=function(a){return $(a).parent().prev().find("input")},this.next_input=function(a){return $(a).parent().next().find("input")},this.num_items=function(){return b.orig_input.parent().find("input[type=text]").length},this.delete_item=function(a){return this.prev_input(a).focus(),this.input_container(a).remove(),this},this.create_item=function(a,c){if(!(this.config.max>0&&this.num_items()>=this.config.max)){var d=$("<div>").css("clear","both"),e=$("<input />").css("width","80%").css("float","left").attr("type","text").val(a);if(d.append(e),"undefined"==typeof c?this.orig_input.parent().append(d):d.insertAfter(this.input_container(c)),e.focus(),e.on("keydown",function(a){13===a.keyCode&&(a.preventDefault(),b.create_item("",this)),(8===a.keyCode||46===a.keyCode)&&""===$(this).val()&&(a.preventDefault(),b.delete_item(this)),38===a.keyCode&&b.prev_input(this).focus(),40===a.keyCode&&b.next_input(this).focus()}),e.on("keyup",function(){if(b.config.auto_split){var a=b.config.separator,c=$(this).val(),d=c.substring(c.length-a.length);d==a&&($(this).val(c.substring(0,c.length-a.length)),b.create_item("",this))}}),b.config.show_actions){var f,g,h,i,j;i=$("<a>").addClass(b.config.btn_css_class).addClass(b.config.btn_delete_css_class).css("margin","5px").html(b.config.btn_delete_html),i.on("click",function(){b.delete_item(e)}),b.config.drag_and_drop?(f=$("<a>").addClass(b.config.btn_css_class).addClass(b.config.btn_reorder_css_class).css("margin","5px").html(b.config.btn_reorder_html),$(".sortable").sortable({handle:"."+b.config.btn_reorder_css_class,axis:"y",forcePlaceholderSize:!0})):(g=$("<a>").addClass(b.config.btn_css_class).addClass(b.config.btn_reorder_up_css_class).css("margin","5px").html(b.config.btn_reorder_up_html),g.on("click",function(){var a=b.input_container(b.prev_input(e));e.parent().insertBefore(a)}),h=$("<a>").addClass(b.config.btn_css_class).addClass(b.config.btn_reorder_down_css_class).css("margin","5px").html(b.config.btn_reorder_down_html),h.on("click",function(){var a=b.input_container(b.next_input(e));e.parent().insertAfter(a)})),j=$("<a>").addClass(b.config.btn_css_class).addClass(b.config.btn_add_css_class).css("margin","5px").html(b.config.btn_add_html),j.on("click",function(){b.create_item("",e)});var k=$("<div>").css("display","none");k.append(i),b.config.drag_and_drop?k.append(f):(k.append(g),k.append(h)),k.append(j),k.insertAfter(e),d.on("mouseenter",function(){k.show()}),d.on("mouseleave",function(){k.hide()})}}},this.val=function(){var a=[];b.orig_input.parent().find("input[type=text]").each(function(){a.push($(this).val())});var c=a.join(b.config.separator);return this.orig_input.val(c),c},this.init()},function(a){a.fn.multiple_inputs=Charcoal.Form.Multiple_inputs}(jQuery);